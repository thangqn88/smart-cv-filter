@model SmartCVFilter.Web.Models.CreateApplicantRequest
@{
    ViewData["Title"] = "Debug Create Applicant";
    Layout = "_Layout";
    var jobPostId = ViewData["JobPostId"];
}

<div class="container mt-4">
    <h2>Debug Create Applicant Form</h2>
    <p>Job Post ID: @jobPostId</p>

    <form asp-controller="Applicants" asp-action="DebugCreate" method="post"
        enctype="application/x-www-form-urlencoded">
        @Html.AntiForgeryToken()
        <input type="hidden" name="jobPostId" value="@jobPostId" />

        <div class="mb-3">
            <label for="FirstName" class="form-label">First Name *</label>
            <input type="text" id="FirstName" name="FirstName" class="form-control" value="John" required>
        </div>

        <div class="mb-3">
            <label for="LastName" class="form-label">Last Name *</label>
            <input type="text" id="LastName" name="LastName" class="form-control" value="Doe" required>
        </div>

        <div class="mb-3">
            <label for="Email" class="form-label">Email *</label>
            <input type="email" id="Email" name="Email" class="form-control" value="john.doe@example.com" required>
        </div>

        <div class="mb-3">
            <label for="PhoneNumber" class="form-label">Phone Number</label>
            <input type="text" id="PhoneNumber" name="PhoneNumber" class="form-control" value="+1234567890">
        </div>

        <button type="submit" class="btn btn-primary">Submit Debug Form</button>
    </form>

    <hr>

    <h3>Debug Information</h3>
    <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
    <p><strong>Form Action:</strong> <span id="formAction"></span></p>
    <p><strong>Method:</strong> POST</p>
    <p><strong>Anti-forgery token present:</strong> <span id="tokenPresent"></span></p>
    <p><strong>Model is null:</strong> @(Model == null ? "Yes" : "No")</p>

    @if (Model != null)
    {
        <p><strong>Model FirstName:</strong> @Model.FirstName</p>
        <p><strong>Model LastName:</strong> @Model.LastName</p>
        <p><strong>Model Email:</strong> @Model.Email</p>
    }

    <script>
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('formAction').textContent = document.querySelector('form').action;
        document.getElementById('tokenPresent').textContent = document.querySelector('input[name="__RequestVerificationToken"]') ? 'Yes' : 'No';

        // Handle form submission
        document.querySelector('form').addEventListener('submit', function (e) {
            console.log('Debug form submission started');

            const formData = new FormData(this);
            console.log('Debug form data being submitted:');
            for (let [key, value] of formData.entries()) {
                console.log(key + ': ' + value);
            }

            // Check required fields
            const firstName = document.getElementById('FirstName').value;
            const lastName = document.getElementById('LastName').value;
            const email = document.getElementById('Email').value;

            console.log('Debug required fields check:');
            console.log('FirstName:', firstName, 'Length:', firstName.length);
            console.log('LastName:', lastName, 'Length:', lastName.length);
            console.log('Email:', email, 'Length:', email.length);

            if (!firstName || firstName.trim() === '') {
                console.error('Debug: FirstName is empty');
                e.preventDefault();
                alert('First Name is required');
                return false;
            }

            if (!lastName || lastName.trim() === '') {
                console.error('Debug: LastName is empty');
                e.preventDefault();
                alert('Last Name is required');
                return false;
            }

            if (!email || email.trim() === '') {
                console.error('Debug: Email is empty');
                e.preventDefault();
                alert('Email is required');
                return false;
            }

            console.log('Debug form validation passed, submitting...');
        });
    </script>
</div>
