@model SmartCVFilter.Web.Models.CreateApplicantRequest
@{
    ViewData["Title"] = "Test Create Applicant";
    Layout = "_Layout";
    var jobPostId = ViewData["JobPostId"];
}

<div class="container mt-4">
    <h2>Test Create Applicant Form</h2>
    <p>Job Post ID: @jobPostId</p>

    <form asp-controller="Applicants" asp-action="TestCreate" method="post" class="needs-validation" novalidate>
        @Html.AntiForgeryToken()
        <input type="hidden" name="jobPostId" value="@jobPostId" />

        <div class="mb-3">
            <label asp-for="FirstName" class="form-label">First Name *</label>
            <input asp-for="FirstName" type="text" class="form-control" value="John" required>
            <span asp-validation-for="FirstName" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="LastName" class="form-label">Last Name *</label>
            <input asp-for="LastName" type="text" class="form-control" value="Doe" required>
            <span asp-validation-for="LastName" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Email" class="form-label">Email *</label>
            <input asp-for="Email" type="email" class="form-control" value="john.doe@example.com" required>
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="PhoneNumber" class="form-label">Phone Number</label>
            <input asp-for="PhoneNumber" type="text" class="form-control" value="+1234567890">
            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        </div>

        <button type="submit" class="btn btn-primary">Submit Test Form</button>
    </form>

    <hr>

    <h3>Debug Information</h3>
    <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
    <p><strong>Form Action:</strong> <span id="formAction"></span></p>
    <p><strong>Method:</strong> POST</p>
    <p><strong>Anti-forgery token present:</strong> <span id="tokenPresent"></span></p>
    <p><strong>Model is null:</strong> @(Model == null ? "Yes" : "No")</p>

    @if (Model != null)
    {
        <p><strong>Model FirstName:</strong> @Model.FirstName</p>
        <p><strong>Model LastName:</strong> @Model.LastName</p>
        <p><strong>Model Email:</strong> @Model.Email</p>
    }

    <script>
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('formAction').textContent = document.querySelector('form').action;
        document.getElementById('tokenPresent').textContent = document.querySelector('input[name="__RequestVerificationToken"]') ? 'Yes' : 'No';

        // Handle form submission
        document.querySelector('form').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            console.log('Form data being submitted:');
            for (let [key, value] of formData.entries()) {
                console.log(key + ': ' + value);
            }

            fetch(this.action, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Response:', data);
                    alert('Form submitted successfully! Check console for details.');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error submitting form: ' + error.message);
                });
        });
    </script>
</div>
